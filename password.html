<include file="Public:header4" />
<div class="autobox">
 <div class="now">
  <a href="/" class="orange">首页</a> &gt; <a href="/user/index.html" class="orange">安全中心 </a> &gt; 修改登录密码
 </div>
 <div class="assets_center clear po_re zin70">
  <!--左侧菜单-->
  <include file="Public:left" />
  <!--右侧内容-->
  <div class="assets_content w900 right bg_w">
   <div class="safe_center clear" style="padding-left: 0px; border-bottom: 2px solid #1dd2af;">
    <h1 style="margin-top: 0px; margin-bottom: 15px; line-height: 15px;">修改密码</h1>
   </div>
   <br>
   <div class="sj" style="top: 40px; left: 82px;"></div>
   <div class="nav_info">
    <p>
     <i></i><span id="pw-msg">为确保您的顺利交易，请牢记登录密码!</span>
    </p>
   </div>
   <br />
   <br />
   <div class="pwtrade">
    <!-- 开始 -->
             <div class="xiaobaobei" style="height:780px;">
           <div class="xiaoxiug">
              <div class="xiaoxiug-left">修改密码</div>
              <div class="xiaoxiug-right hover">修改交易密码</div>
           </div>
               <div class="xiaobaobei-bottom">
            <ul>
               <li>
                <span>登录密码：</span>
                <input type="password" id="oldpassword">
               </li>
               <li>
                <span>新密码：</span>
                <input type="password" id="newpassword">
               </li>
               <li>
                <span>重复密码：</span>
                <input type="password" id="repassword">
               </li>
               <li>
                <span>正面身份证：</span>
                <em style="border:0"><input type="file" id="zhengmian"></em>
                <input type="hidden" name="zhengmian" id="zhengmian_v" value="">
                <p class="p1">支持jpg、png、gif；小于1MB的图片</p>
               </li>
               <li>
                <span>反面身份证：</span>
                <em style="border:0"><input type="file" id="fanmian"></em>
                <input type="hidden" name="fanmian" id="fanmian_v" value="">
                <p class="p2">支持jpg、png、gif；小于1MB的图片</p>
               </li>
               <li>
                <span>手持身份证：</span> 
                <em style="border:0"><input type="file" id="shouchi"></em>
                <input type="hidden" name="shouchi" id="shouchi_v" value="">
                <p class="p3">支持jpg、png、gif；小于1MB的图片</p>
               </li>
            </ul>
            <input type="submit" onclick="Update()" class="xiaotijiao" value="提交">
           </div>


		   <div class="xiaobaobei-bottom" style="display: none">
            <ul>
               <li>
                <span>登录密码：</span>
                <input type="password" id="ppassword">
               </li>
               <li>
                <span>交易密码：</span>
                <input type="password" id="oldpaypassword">
               </li>
               <li>
                <span>新交易密码：</span>
                <input type="password" id="newpaypassword">
               </li>
               <li>
                <span>重复交易密码：</span>
                <input type="password" id="repaypassword">
               </li>
               <li>
                <span>正面身份证：</span>
                <em style="border:0!important"><input type="file" id="pzhengmian"></em>
                <input type="hidden" name="pzhengmian" id="pzhengmian_v" value="">
                <p class="p4">支持jpg、png、gif；小于1MB的图片</p>
               </li>
               <li>
                <span>反面身份证：</span>
                <em style="border:0!important"><input type="file" id="pfanmian"></em>
                <input type="hidden" name="pfanmian" id="pfanmian_v" value="">
                <p class="p5">支持jpg、png、gif；小于1MB的图片</p>
               </li>
               <li>
                <span>手持身份证：</span>
                <em style="border:0!important"><input type="file" id="pshouchi"></em>
                <input type="hidden" name="pshouchi" id="pshouchi_v" value="">
                <p class="p6">支持jpg、png、gif；小于1MB的图片</p>
               </li>
            </ul>
            <input type="submit" onclick="Pupdate()" class="xiaotijiao" value="提交" style="margin-top:30px;">
           </div>
         </div>
  <!-- 结束 -->
   </div>
  </div>
 </div>
</div>
<br>
<br>
<script>
$(function(){
  // 正面
  $("#zhengmian").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'正面身份证',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#zhengmian_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p1").html("已上传成功");
          $(".p1").css("color","#c10d26");
          $(".p1").css("padding-right","98px");


        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

    $("#fanmian").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'反面身份证',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#fanmian_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p2").html("已上传成功");
          $(".p2").css("color","#c10d26");
          $(".p2").css("padding-right","98px");
        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

    $("#shouchi").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'手持身份证正面',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#shouchi_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p3").html("已上传成功");
          $(".p3").css("color","#c10d26");
          $(".p3").css("padding-right","98px");
        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

$("#pzhengmian").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'正面身份证',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#pzhengmian_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p4").html("已上传成功");
          $(".p4").css("color","#c10d26");
          $(".p4").css("padding-right","98px");
        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

    $("#pfanmian").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'反面身份证',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#pfanmian_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p5").html("已上传成功");
          $(".p5").css("color","#c10d26");
          $(".p5").css("padding-right","98px");
        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

    $("#pshouchi").uploadify({
      'swf' : '/Public/Test/js/uploadify.swf',
      'uploader' : "{:U('Login/uplodes')}",
      'buttonText':'手持身份证正面',
      'onUploadSuccess' : function(file,data,response){
        var jso = eval("("+data+")");
        
        if(jso.status == 1){
          $('#pshouchi_v').attr("value",jso.src);
          
          layer.msg('上传成功！',{icon:1});
          $(".p6").html("已上传成功");
          $(".p6").css("color","#c10d26");
          $(".p6").css("padding-right","98px");
        }else{
          layer.msg('上传失败！',{icon:2});
        }
      }
    });

})

  $('input').focus(function(){
    var t=$(this);
    if(t.attr('type')=='text'||t.attr('type')=='password')
      t.css({'box-shadow' : '0px 0px 3px #1583fb','border' : '1px solid #1583fb','color' : '#333' });
    if(t.val()==t.attr('placeholder'))
      t.val('');
  });
  $('input').blur(function(){
    var t=$(this);
    if(t.attr('type')=='text'||t.attr('type')=='password')
      t.css({'box-shadow' : 'none','border' : '1px solid #e1e1e1','color' : '#333' });
    if(t.attr('type')!='password'&&!t.val())
      t.val(t.attr('placeholder'));
  });

  function Update(){
    var oldpassword = $('#oldpassword').val();
    var newpassword = $('#newpassword').val();
    var repassword  = $('#repassword').val();
    var zhengmian   = $('#zhengmian_v').val();
    var fanmian     = $('#fanmian_v').val();
    var shouchi     = $('#shouchi_v').val();

    if(oldpassword == ''|| oldpassword ==null){
      // layer.msg('原始登录密码必须填写',{icon:2});
      layer.alert('原始登录密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });

      return false;
    }else{
      $.post("{:U('User/chickpwd')}",{pwd:oldpassword},function(data){
        if(data.status != '1'){
          layer.msg(data.info,{icon:2});
          return false;
        }
      });
    }
    if(newpassword == ''|| newpassword ==null){
      // layer.msg('新登录密码必须填写',{icon:2});
      layer.alert('新登录密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
    if(repassword == ''|| repassword ==null){
      // layer.msg('确认密码必须填写',{icon:2});
      layer.alert('确认密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
    if(repassword !=newpassword){
      // layer.msg('新登录密码必须与确认密码一致',{icon:2});
      layer.alert('新登录密码必须与确认密码一致', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
    if(fanmian == ''|| fanmian ==null){
      // layer.msg('必须上传身份证反面图片',{icon:2});
      layer.alert('必须上传身份证反面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
    if(zhengmian == ''|| zhengmian ==null){
      // layer.msg('必须上传身份证正面图片',{icon:2});
      layer.alert('必须上传身份证正面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
    if(shouchi == ''|| shouchi ==null){
      // layer.msg('必须上传手持身份证正面图片',{icon:2});
      layer.alert('必须上传手持身份证正面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      return false;
    }
  


    $.post("{:U('User/uppassword')}",{oldpassword : oldpassword,newpassword : newpassword,repassword : repassword,zhengmian:zhengmian,fanmian:fanmian,shouchi:shouchi },function(data){
      if(data.status==1){
        // layer.msg(data.info,{time:2000,btn:['确定']});
        layer.alert(data.info, {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       },function(){
          window.location="{:U('User/password')}";
       });
        

        
      }else{
        layer.alert(data.info, {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       },function(){
          if(data.url){
          window.location=data.url;
        }else{
          layer.closeAll();
        }
       });
        
      }
    },"json");
    $(".layui-layer").css("top","200px");
  }


  function Pupdate(){
    var ppassword      = $('#ppassword').val();
    var oldpaypassword = $('#oldpaypassword').val();
    var newpaypassword = $('#newpaypassword').val();
    var repaypassword  = $('#repaypassword').val();
    var pzhengmian     = $('#pzhengmian_v').val();
    var pfanmian       = $('#pfanmian_v').val();
    var pshouchi       = $('#pshouchi_v').val();

    if(ppassword == ''|| ppassword ==null){
      layer.alert('原始登录密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('原始登录密码必须填写',{icon:2});
      return false;
    }else{
      $.post("{:U('User/chickpwd')}",{pwd:ppassword},function(data){
        if(data.status != 1){
          layer.msg(data.info,{icon:2});
          return false;
        }
      });
    }

    if(oldpaypassword == '' || oldpaypassword == null){
      layer.alert('原始支付密码必须填写！', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      return false;
    }

    if(newpaypassword == ''|| newpaypassword ==null){
      layer.alert('新支付密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      // layer.msg('',{icon:2});
      return false;
    }
    if(repaypassword == ''|| repaypassword ==null){
      layer.alert('确认支付密码必须填写', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      return false;
    }
    if(repaypassword != newpaypassword){
      layer.alert('新支付密码必须与确认密码一致', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      return false;
    }
    if(pfanmian == ''|| pfanmian ==null){
      layer.alert('必须上传身份证反面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('必须上传身份证反面图片',{icon:2});
      return false;
    }
    if(pzhengmian == ''|| pzhengmian ==null){
      layer.alert('必须上传身份证正面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      return false;
    }
    if(pshouchi == ''|| pshouchi ==null){
      layer.alert('必须上传手持身份证正面图片', {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       });
      // layer.msg('',{icon:2});
      return false;
    }

    $.post("{:U('User/uppaypassword')}",{password:ppassword,oldpaypassword : oldpaypassword,newpaypassword : newpaypassword,repaypassword : repaypassword,zhengmian:pzhengmian,fanmian:pfanmian,shouchi:pshouchi },function(data){
      if(data.status==1){
        // layer.msg(data.info,{time:2000,btn:['确定']});
        layer.alert(data.info, {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       },function(){
          window.location="{:U('User/password')}";
       });
        

        
      }else{
        layer.alert(data.info, {
         title:"温馨提示",
         skin: 'layui-layer-molv',//样式类名
         closeBtn: 0,   
       },function(){
          if(data.url){
          window.location=data.url;
        }else{
          layer.closeAll();
        }
       });
        
      }
    },"json");
  }
   //密码选项卡区域
   var xiao = null;
        $('.xiaoxiug > div').click(function(){
          xiao = $(this).index();
          $(this).removeClass('hover').siblings('div').addClass('hover');
          $('.xiaobaobei').find('.xiaobaobei-bottom').eq(xiao).show().siblings('.xiaobaobei-bottom').hide();
        });


</script>
<script>
  $("title").html("{:C('web_title')} - 安全中心 - 登录密码");
  //顶部菜单高亮
  $('#user_box').addClass('active');
  $('#user_password').addClass('active');
  $('#user_password i').attr('class','coin_menu_op_9');
$(".layui-layer").css("top","200px");
</script>
<include file="Public:footers" />